---
title: "סימובולוגיה, מידע ומרחב"
author: 'ד"ר עדו קליין'
lang: he
dir: rtl
output:
  slidy_presentation: default
  ioslides_presentation: default
---
```{r include=FALSE}
pacman::p_load(downloadthis)
```


# סימבולוגיה

## תרגיל ראשון:



1.  פתחו את הפרויקט מהגאופקג' 

2.  ייצגו את המבנים בת"א לפי שנת הבנייה

3.  יצגו את בתי הספר במפה לפי הישוב בהם הם נמצאים

4.  שמרו על השינויים בפרויקט

5.  פתחו פרויקט חדש, וטענו שוב את הפרויקט

## תגיות

לעיתים נרצה לייצג את הישויות שלנו בצורה טקסטואלית על גבי המפה. נלך לטאב הlabels בproperties של השכבה. לרוב נרצה את single lables

![](paste-7B544A85.png)

ניתן לקבוע ערכים רבים לגבי הטקסט - המשמעותי ביותר היא העמודה או הביטוי שמייצג אותו (value). ניתן לשלוט בגודל הפונט, בסוג שלו בשקיפות וכו'. בתפריט בצד ניתן לראות עוד אפשרויות - צבע מסביב לטקסט, טקסט רומס או לא רומס, וכו'. אין כאן המקום להאריך, בעיקר מציע לשחק או לגגל. ![](paste-30DEA766.png)

## גלגל ההצלה האולטימטיבי - היסטוריה של סגנונות!

קורה שמייצרים סגנון חדש לשכבה, אבל מתחרטים ולא זוכרים מה היה בסגנון הקודם.

ניתן לעקוב אחרי ההיסטוריה של הסגנונות בפאנל:![](paste-E3880218.png)

## סגנון משתחזר

לפעמים נרצה לשחזר סגנון בצורה מדויקת, בין אם זה בתוך אותה שכבה, או בין אם זה בין שכבות שונות.

## שמירה על סגנונות מרובים באותה השכבה

![](paste-0851A8D3.png)

ושיום של הסגנון. לאחר מכן נוכל לשנות לייצר סגנון חדש, לשיים אותו, ולבחור בין השניים לפי הצורך.

## העתקת סגנון משכבה לשכבה

ניתן ללחוץ על שכבה ולהעתיק ממנה את הסגנון:

![](paste-5FE354AD.png)

ולאחר מכן, להעביר את הסגנון לשכבה שמכילה את אותם הנתונים עם paste style, שיווצר מתחת לcopy style

## תרגיל שני:

```{r echo=FALSE}
download_file("mavat.gpkg",button_label = "להורדת הקובץ")
```


1.  טענו את פרויקט mavat מהגאופקג' mavat שהורדתם עכשיו

2.  שמרו על הסגנון של שכבת rehovot east

3.  העתיקו את הסגנון של שכבת mavat_plan

4.  העבירו אותו אל שכבת rehovot east

5.  שמרו על הסגנון החדש

6.  העבירו בין שני הסגנונות

## טעינת ושמירת סגנון מקובץ/לקובץ

פעמים רבות נעבוד עם דאטה שיש לו פורמט אחוד, או שיש לנו הרבה שכבות באותו פורמט. ולכן, עיצוב אחיד שנטען משכבה אחרת במקרים אלו יכול מאוד לעזור.

קבצי qml וsld יכולים לעזור לנו בסוגיה זו.

שניהם קבצים ממשפחת xml, אך בעוד sld תואם לפורמט הכללי כפי שנקבע על ידי הogc, qml מותאם ספציפית לqgis.

ככה נראה qml מבפנים![](paste-E64BBB18.png)

הוא למעשה מגדיר בצורה מדוקדקת את הייצוג של כל אחד מהשדות.

בשביל להעביר בצורה יותר קלה בין פלטפורמות, כדאי להשתמש בsld, אבל qml מאפשר גמישות נוספת בהגדרות של עיצוב לפי מנוע הביטויים, בו בתקווה ניגע בהמשך הקורס.

## טעינת ושמירת סגנון מקובץ/לקובץ - 2

![](paste-332C2A39.png)

שם יש צורך לבחור טעינה מקובץ, שמירה על כל הקטגוריות, ובחירה בקובץ הsld או הqml.

באותה צורה ניתן גם לשמור סגנון, כsld,כqml או בתוך הגאופקג' (וארחיב קצת בהמשך)

[לינק חשוב מאוד - סגנונות mavat לqgis](https://www.gov.il/he/departments/general/symbology_qgis)

## תרגיל שלישי:

1.  פתחו את פרויקט mavat_no_symbology מהגאופקג'mavat.

2.  החליפו את הסימבולוגיה של השכבות לסימבולוגית mavat סטנדרטית, באמצעות הקבצים מהקישור, או במידה ואתם בוחרים בקבצים בתיקייה.

## טעינת ושמירת סגנון מgpkg

חשוב לדעת שניתן לשמור את הסגנונות שיש לנו ישירות אל תוך הgpkg,ולא לקובץ נפרד, ככה שנדע לנהל אותם בצורה של אי ריבוי קבצים, ולייצא החוצה במידה הצורך, אם רוצים להעביר לפרויקט אחר. הסגנונות נשמרים מחוץ לפרויקט, וגם אם עובדים עם גאופקג' נטול פרויקט, הם יטענו כמות שהם. חבל שמינהל התכנון לא מפרסם את כל קצבי הmavat כגאופקג'.

## המלצה ארגונית חמה

בפרויקטים משתחזרים עתידיים, לייצר סגנונות ארגוניים קבועים לשכבות מסוימות. ברוב המקרים הם יתאימו. לעיתים תצטרכו לעשות קצת התאמות, אבל יהיה לכם בייסליין קל.

# מידע ומרחב

## הקדמה

לרוב מתכנני תחבורה יקבלו מידע מוכן מראש, ועליו יבצעו ניתוחים כאלה ואחרים. לעיתים בעבודה עם qgis נצטרך לערוך שכבות, כתלות בסוג העבודה. נדון בעריכת שכבות (הן בהוספת מידע והן בדיגיטציה) בשיעור הבא. נדון יותר לעומק בעריכה ובדיגיטציה. בשיעור זה נתמקד בעבודה בסיסית עם מידע.

## טבלת ישויות

כפתור ימני ו

![](paste-E449EFC2.png)

נקבל טבלה סטנדרטית, נתעכב בקצרה על חמישה אלמנטים:

### הכותרת

![](paste-58CA9475.png)

שם השכבה, סך הישויות, ישויות שפולטרו, ישויות שנבחרו

### השורה

![](paste-F6D005FC.png)

לחיצה על החלק המספר האפור משמאל תוביל לבחירת הישויות

לחיצה על כפתור ימני על אחד מתאי השורה תוביל לדיאלוג הבא

![](paste-41EEF092.png)

כל המתודות שקשורות לfeature מאוד עוזרות בהתמקדות על ישויות מסוימות.

כמובן שלחיצה על ראשי העמודות תסדר את השורות בסדר עולה או יורד, על פי שם העמודה שלחצתם עליה.

### סרגל הכלים

![](paste-919EA3C1.png)

לסרגל הכלים יכולות רבות מאוד.

ניתן באמצעות לפתוח את השכבה לעריכה (נדבר על עריכה בשיעור הבא) ולשלוט בחלק מהיבטי העריכה באמצעות הסרגל.

ניתן לבצע שאילתא טבלאית או פילטר מסוגים רבים

ניתן להוסיף שדות או עמודות

ניתן לעשות עיצוב מותנה

ניתן לעגן את הטבלה

### פינה ימנית תחתונה

![](paste-A4D50198.png)

מעבר ממבט טבלה למבט טופס, ולהיפך. מבט טופס אינו נוח כל כך אבל לפעמים הוא מועיל.

### פינה שמאלית תחתונה

![](paste-843D9BF6.png)

תפריט נוסף המאפשר צפייה בישויות לפי מצבן הנוכחי.

## בחירה ידנית

למדנו לבצע בחירה ידנית בטבלה על ידי לחיצה על השורה. ניתן לבחור ישויות גם באמצעות בחירתן על גבי המפה באמצעות פאנל הבחירה

![](paste-CE22FD33.png)

הכפתור השמאלי מאפשר את הבחירה באמצעות לחיצה על ישויות.

![](paste-A582C59D.png)

ניתן גם לסרטט פוליגון, או צורה חופשית, או רדיוס, על מנת לבצע בחירה על גבי המפה.

טיפ של אלופים:

החזיקו את shift או ctrl על מנת להוסיף או להחסיר ישויות מהבחירה

על הכפתור האמצעי נדבר בהמשך

![](paste-CACCCE51.png)

מבטל את כל הישויות הנבחרות (ניתן לשנות לשכבה האקטיבית הנוכחית או לכל השכבות)

## תרגיל רביעי: בחירה

```{r echo=FALSE}
download_file("lesson_3.gpkg",button_label = "להורדת הקובץ")
```

בצעו 3 בחירות:

קו הרק"ל של חוצה ישראל

תחנת הרקל הקרובה ביותר למשרדי ארא ירושלים

כל תחנות הרקל התחתיות

## שאילתא טבלאית

נחזור לכפתור האמצעי בפאנל הבחירה.

שתי אפשרויות: בחירה לפי ביטויים ולפי ערכים. בחירה לפי ביטויים היא קצת מורכבת, ואולי נתעכב עליה בהמשך הקורס. נתמקד בבחירה לפי ערכים.

![](paste-D17DDC3A.png)

בדיאלוג ניתן לראות את שדות הטבלה. בצד ימין - דרופדאון שמאפשר לנו לבחור את היחס בין הערך הטבלאי לערך אותו נציין. בלבן נזין את הערך, במידה ומדובר בטקסט תהיה השלמה אוטומטית.

היחסים של ערך מספרי:

![](paste-F69263F2.png)

היחסים של ערך טקסטואלי:

![](paste-F351107C.png)

על מנת לבחור, נלחץ על select features. ניתן גם לייצר בחירות מסוגים אחרים.

## שאילתא מרחבית

מכיוון שאנחנו מתעסקים עם מרחב, נרצה לדעת לבחור ישויות בהתאם ליחס שלהן לישויות מרחביות אחרות, ולא רק לערכים שלהן.

אחזור על המנטרה - אנחנו ממשיכים להתעסק עם עמודת המרחב, רק שהפעולה אותה אנחנו מבצעים מולה היא השוואה מסוגים מסוים, עבור ישויות מוגדרות מראש.

![](paste-5D51055F.png)

ניתן לגשת גם מהprocessing toolbox

ההשואה תתבצע בין כל הישויות בשכבה אחת, אל מול ישויות אחרות - בין אם אלו ישויות בשכבה אחרת, ובין אם אלו ישויות שנבחרו באותה השכבה.

![](paste-EA2691B5.png)

## יחסים מרחבים: 

יש הרבה מאוד סוגים של יחסים בין כל צמד ישויות מרחביות שנמצאות במרחב דו מימדי. 512 ליתר דיוק. [קריאה נוספת מומלצת](https://en.wikipedia.org/wiki/DE-9IM)

היחסים הנפוצים הם הצטלבות, הכלה, נגיעה, חפיפה, חצייה.

לא נרחיב כאן את היריעה, מכיוון שהצטלבות, שהיא ברירת המחדל, היא רוב מה שנצטרך.

ניתן להרחיב את היריעה כאן בקריאה הנוספת המומלצת. ניתן גם לראות הסבר קצר במדריך של [postgis](https://postgis.net/workshops/postgis-intro/spatial_relationships.html)

## תרגיל חמישי: שאילתות

בצעו 3 שאילתות:

בחרו את כל תחנות הרק"ל התחתיות

בחרו את כל תחנות הרק"ל בקווים שצבעם אדום

בחרו את כל קווי הרקל שעוברים בתחנת החאן (השתמשו בשכבת station buffer)

## פונקציות טבלאיות

QGIS מאפשר מספר פונקציות של סיכום או עיבוד לטבלה כולה, על מנת להפיק מדדים כמו ממוצע, חציון, סכום, סטיית תקן וכו'.

### סטטיסטיקה בסיסית

![](paste-CE53EADE.png)

בחירת שכבת ושדה מהשכבה:

![](paste-FC4612C8.png)

תוצאות חוזרות בלוג או בקובץ HTML בפאנל RESULTS

### ערכים ייחודיים

![](paste-5B254FE2.png)

נפתח דיאלוג דומה לקודם, יש לבחור את השכבה ואת השדה שרוצים לדעת עבורו את הערכים המיוחדים. הפלט מחזיר את מספר הערכים ואת ערכם.

## פאנל סטטיסטיקה

![](paste-2909C01D.png)

פאנל הסטטיסטיקה נותן ערכים בסיסיים, בדומה לפונקצית basic statistics for fields.

## תרגיל שישי: פונקציות טבלאיות

ענו על השאלות הבאות:

כמה חברות שונות לפיתוח קווי רק"ל יש? מה שמותן?

מהו הסטטוס הנפוץ ביותר של פיתוח קווי רקל?

כמה תחנות רק"ל יש בקווים שצבעם חום? (היעזרו בבחירה, בצעו באמצעות הפונקציות)

## גאומטריה חישובית על קצה המזלג

עד כה, הדגמנו שאילתות או ניתוחים שלוקחים בחשבון בעיקר את העמודות הלא מרחביות בטבלה (למעט בבחירה לפי מיקום).

כעת, נרצה למנף את הכוח של מערכות המידע הגיאוגרפיות, ולבצע ניתוחים מורכבים יותר, שמתאפשרים לנו על ידי גאומטריה חישובית.

כשאני אומר גאומטריה חישובית, אני מתכוון לסט הפונקציות המתמטיות החישוביות שניתן לבצע על סט גאומטריות על מנת לבצע ניתוחים מרחביים. [להרחבה](https://en.wikipedia.org/wiki/Computational_geometry)

תחום זה הוא למעשה התורם המרכזי של ביצוע פעולות gisיות.

## פונקציות מרחביות בסיסיות

### הצלבה

יצירת סט ישויות חדשות, המבוססות על שתי שכבות קלט. האלוגריתם לוקח את הגאומטריה המשותפת בין כל שתי ישויות מהשכבות השונות, ומחזיר את התוצאות בשכבה חדשה.

חשוב מאוד לציין - במידה ויש לנו ישויות מסוגים שונים(נקודות קווים פוליגונים) - יוחזרו תוצאות מהשכבה הנחותה יותר (למשל - נקודה וקו - נקודה, קו ופוליגון - קו).

![](paste-7203BD98.png)

שכבת האינפוט תמיד תהיה מהזן הנחות יותר, שכבת הoverlay - מהזן היותר גבוה.

![](paste-033EEA03.png)

### חיץ

מרחיב את הישות ומוסיף לה חיץ מסביבה. בהגדרה הופך את השכבה לפוליגונלית.

![](paste-9C5CCD6B.png)

![](paste-133B85BC.png)

בעיקר - בחירת השכבה וציון המרחק, לפי יחידות המידה. יש לשים לב - יעבוד רק עם שכבות שהומרו לרשת מוטלת, כמו ישראל חדשה ודומותיה. כל יתר הפרמטרים הם של אופי ההרחבה, ופחות חשובים.

### טשטוש גבולות

מאחד ישויות באותה שכבה להן יש ערך משותף בשדה מסוים, שהוגדר על ידי המשתמש.

![](paste-9C37B228.png)

יש לספק רק שכבה ואת שם השדה עליו מבצעים את הטשטוש

![](paste-FC0347B4.png)

שימו לב - ניתן לקרוא הסבר על כל כלי באיזור שמסומן בכחול.

## תרגיל שביעי: פונקציות מרחביות

ייצרו את השכבות הבאות:

קווי רקל במינהלים קהילתיים

חיץ של 300 מטרים מקווי רקל

שכבה עם שלושה אזורים, לפי מגזר, במטרופולין ירושלים (למתקדמים: חפשו את delete holes לשיפור נראות התוצאה)


### בונוס למתקדמים

ענו על השאלה הבאה:

מה אורך קווי הרק"ל המתוכננים במינהל קהילתי גוננים?



<link href="my-style.css" rel="stylesheet">


